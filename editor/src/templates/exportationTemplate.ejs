;(function($) {
    $(document).ready(function() {
        var story = new NLSStory([
        <% _(steps).each(function(step) { %>
            new NLSStep('<%= escapeString(step.name) %>', [
            <% _(step.paragraphs).each(function(paragraph) { %>
                <% if (paragraph.type === 'text') { %>
                new NLSText(
                    <% if (paragraph.isTextJavascript) { %>
                    function(nls) {
                        <%= paragraph.text %>
                    },
                    <% } else { %>
                    '<%= escapeString(paragraph.text) %>',
                    <% } %>
                    <% if (paragraph.isVisible) { %>
                    function(nls) {
                        <%= paragraph.isVisible %>
                    }
                    <% } else { %>
                    undefined
                    <% } %>
                ),
                <% } else if (paragraph.type === 'path') { %>
                new NLSAction(
                    <% if (paragraph.isTextJavascript) { %>
                    function(nls) {
                        <%= escapeString(paragraph.text) %>
                    },
                    <% } else { %>
                    '<%= escapeString(paragraph.text) %>',
                    <% } %>
                    '<%= escapeString(paragraph.toStep) %>',
                    <% if (paragraph.onClick) { %>
                    function(nls) {
                        <%= paragraph.onClick %>
                    },
                    <% } else { %>
                    undefined,
                    <% } %>
                    <% if (paragraph.isVisible) { %>
                    function(nls) {
                        <%= paragraph.isVisible %>
                    }
                    <% } else { %>
                    undefined
                    <% } %>
                ),
                <% } %>
            <% }) %>
            ]),
        <% }) %>
        ]);

        var nls = new NonLinearStory(story, {
            baseSelector: 'nls',
            initialStep: '<%= settings.startingStep %>',
            outAnimationClass: 'fade-out',
            outAnimationDuration: 200,
            inAnimationClass: 'fade-in',
            inAnimationDuration: 200,
        });

        nls.start();
    })
})(jQuery);